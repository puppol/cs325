import time

def best(bagSize, bagPairs):
    # s = time.time()
    og = [list(e) for e in bagPairs]
    bPairs = []
    for x,y,z in bagPairs:
        bPairs.extend([(x,y) for _ in range(z)])

    tSum = len(bPairs)

    array = [[0] * (bagSize+1) for _ in range(tSum + 1)]
    backTrace = [[0] *(bagSize+1) for _ in range(tSum + 1)]

    # print(time.time() - s)
    # s = time.time()

    for w in range(1,bagSize + 1):
        for pair in range(1,tSum + 1):
            dif = w - bPairs[pair-1][0]
            if dif >= 0:
                a,b = bPairs[pair-1][1] + array[pair-1][dif], array[pair-1][w]
                if a > b:
                    array[pair][w] = a
                    backTrace[pair][w] = dif + w
                else:
                    array[pair][w] = b

                #
                # array[pair][w] = max(bPairs[pair-1][1] + array[pair-1][dif], array[pair-1][w])
                # # Check for backtrace
                # if array[pair][w] != array[pair-1][w]:
                #     backTrace[pair][w] = dif + w

    print(time.time() - s)
    s = time.time()
    pSet = []
    w = bagSize
    pair = tSum
    while w > 0 and pair > 0:
        if backTrace[pair][w] == 0:
            pair -= 1
        else:
            pSet.append(bPairs[pair-1])
            w -= bPairs[pair-1][0]
            pair -= 1

    for v in pSet:
        for i in og:
            if v[0] == i[0] and v[1] == i[1] and i[2] > 0:
                i[2] -= 1
                break
    f = [bagPairs[i][2] - og[i][2] for i in range(len(og))]
    print(time.time() - s)
    return (array[tSum][bagSize], f)


print( best(117, [(19, 28, 26), (25, 3, 9), (4, 16, 25), (15, 16, 21), (13, 26, 7), (4, 16, 1), (29, 27, 13), (14, 20, 25), (25, 1, 23), (15, 9, 24), (26, 8, 19), (4, 29, 11), (1, 1, 1), (21, 18, 1), (29, 13, 22), (7, 14, 24), (1, 17, 8), (25, 15, 16), (18, 8, 12), (8, 22, 8), (25, 15, 10), (30, 1, 14), (27, 30, 18), (30, 21, 4), (6, 21, 24), (28, 10, 4), (24, 11, 29), (24, 23, 17), (30, 14, 17), (27, 30, 22), (7, 10, 10), (19, 29, 16), (28, 17, 13), (19, 28, 2), (16, 8, 24), (26, 13, 14), (22, 6, 12), (18, 29, 23), (25, 22, 24), (12, 3, 15), (22, 17, 4), (25, 6, 17), (27, 13, 12), (16, 24, 1), (16, 2, 10), (23, 28, 20), (19, 19, 13), (21, 6, 6), (17, 8, 1), (25, 7, 18), (30, 28, 18), (8, 13, 17), (12, 28, 19), (12, 15, 30), (9, 22, 18), (20, 24, 1), (13, 26, 28), (27, 29, 24), (17, 26, 5), (17, 25, 18), (7, 14, 2), (16, 28, 12), (19, 18, 7), (17, 14, 16), (27, 12, 14), (12, 1, 18), (18, 20, 26), (20, 11, 15), (20, 1, 26), (8, 21, 6), (18, 19, 6), (28, 3, 26), (18, 26, 28), (27, 30, 9), (2, 27, 22), (3, 3, 28), (1, 15, 1), (25, 25, 9), (8, 9, 4), (26, 20, 6), (12, 10, 3), (6, 6, 9), (17, 6, 22), (9, 21, 23), (10, 15, 23), (11, 16, 16), (4, 1, 10), (13, 11, 14), (26, 7, 9), (4, 9, 29), (24, 17, 7), (20, 14, 27), (1, 8, 1), (13, 5, 2), (24, 6, 15), (23, 17, 22), (14, 18, 27), (8, 21, 26), (23, 17, 15), (8, 17, 21), (1, 13, 22), (19, 26, 11), (22, 21, 14), (2, 24, 10), (5, 7, 29), (2, 10, 3), (28, 3, 10), (30, 10, 24), (6, 14, 19), (9, 5, 1), (18, 29, 28), (2, 19, 27), (7, 29, 19), (15, 6, 27), (28, 28, 25), (23, 20, 17), (2, 13, 7), (12, 4, 7), (19, 22, 29), (14, 19, 7), (16, 4, 22), (13, 10, 17), (16, 1, 11), (20, 28, 13), (29, 10, 1), (6, 7, 28), (11, 26, 19), (26, 5, 11), (14, 7, 9), (22, 4, 27), (13, 30, 18), (12, 30, 29), (27, 22, 18), (16, 25, 18), (8, 3, 24), (2, 3, 5), (6, 6, 30), (18, 7, 9), (25, 11, 20), (17, 27, 9), (12, 11, 11), (4, 10, 8), (28, 20, 25), (23, 29, 16), (5, 19, 18), (25, 4, 11), (2, 14, 3), (13, 28, 26), (5, 27, 5), (11, 4, 20), (19, 26, 30), (13, 3, 19), (18, 8, 19), (3, 9, 12), (29, 10, 19), (18, 30, 4), (15, 29, 9), (4, 26, 2), (27, 10, 1), (20, 22, 1), (3, 14, 4), (27, 29, 26), (2, 7, 8), (26, 19, 14), (6, 4, 15), (6, 22, 8), (6, 24, 28), (4, 14, 30), (13, 26, 18), (30, 27, 10), (18, 9, 23), (16, 11, 4), (7, 21, 11), (2, 1, 1), (26, 30, 10), (24, 20, 11), (15, 13, 11), (13, 3, 3), (30, 11, 20), (15, 4, 9), (7, 26, 20), (25, 29, 18), (28, 23, 16), (22, 12, 9), (6, 18, 7), (10, 7, 8), (12, 3, 27), (9, 3, 25), (15, 3, 21), (19, 21, 11)]))
